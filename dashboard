"use client";
import { useState, useEffect } from "react";
import { Menu, LogOut } from "lucide-react";
import { styles } from "../styles/AppStyles";
import Sidebar from "./Sidebar";
import HomeView from "./views/HomeView";
import CifCreationView from "./views/CifCreationView";
import DepositAccountView from "./views/DepositAccountView";
import LoanAccountView from "./views/LoanAccountView";
import CcodAccountView from "./views/CcodAccountView";
import CkycView from "./views/CkycView";
import SocialAttributeView from "./views/SocialAttributeView";
import AmendView from "./views/AmendView";
import PanCifView from "./views/PanCifView";
import FundTransferView from "./views/FundTransferView";
import PpfView from "./views/PpfView";
import RdView from "./views/RdView";
import FoView from "./views/FoView";
import ExcelBatchView from "./views/ExcelBatchView";
import ModView from "./views/ModView";
import KccView from "./views/KccView";
import NocView from "./views/NocView";
import ErrorResolutionCentreView from "./views/ErrorResolutionCentreView";
import TesterResetView from "./views/TellerResetView";
import TellerSignonView from "./views/TellerSignonView";
import ErrorResolverView from "./views/ErrorResolverView";
import AdminDashboard from "./admin/AdminDashboard";
import UserManagement from "./admin/UserManagement";
import ActivityLogs from "./admin/ActivityLogs";

export default function Dashboard({ user, onLogout }) {
    const [sidebarOpen, setSidebarOpen] = useState(true);
    const [activeService, setActiveService] = useState("home");

    // Check if user is admin
    const isAdmin = user?.role === "admin";

    // Redirect non-admin users if they try to access admin pages
    useEffect(() => {
        if (!isAdmin && ["admin_dashboard", "user_management", "activity_logs"].includes(activeService)) {
            setActiveService("home");
        }
    }, [activeService, isAdmin]);

    const renderContent = () => {
        switch (activeService) {
            case "home":
                return isAdmin ? <AdminDashboard /> : <HomeView user={user} />;
            case "admin_dashboard":
                return <AdminDashboard />;
            case "user_management":
                return <UserManagement />;
            case "activity_logs":
                return <ActivityLogs />;
            case "cif":
                return <CifCreationView />;
            case "deposit":
                return <DepositAccountView />;
            case "loan":
                return <LoanAccountView />;
            case "ccod":
                return <CcodAccountView />;
            case "ckyc":
                return <CkycView />;
            case "social":
                return <SocialAttributeView />;
            case "amend":
                return <AmendView />;
            case "pancif":
                return <PanCifView />;
            case "fundtransfer":
                return <FundTransferView />;
            case "ppf":
                return <PpfView />;
            case "rd":
                return <RdView />;
            case "kcc":
                return <KccView />;
            case "mod":
                return <ModView />;
            case "noc":
                return <NocView />;
            case "fo":
                return <FoView />;
            case "tellerreset":
                return <TesterResetView />;
            case "tellersignon":
                return <TellerSignonView />;
            case "excel":
                return <ExcelBatchView />;
            case "error":
                return <ErrorResolverView />;
            default:
                return <HomeView user={user} />;
        }
    };

    return (
        <div style={styles.dashboardContainer}>
            <nav style={styles.dashboardNav}>
                <div style={styles.dashNavLeft}>
                    <button onClick={() => setSidebarOpen(!sidebarOpen)} style={styles.menuBtn}>
                        <Menu size={24} />
                    </button>
                    <div style={styles.navBrand}>
                        <div style={styles.logoCircleSmall}>SBI</div>
                        <span style={styles.brandTextSmall}>Test Data Platform</span>
                    </div>
                </div>

                <div style={styles.dashNavRight}>
                    <div style={styles.userInfo}>
                        <div style={styles.userAvatar}>
                            {user?.first_name?.[0] || user?.firstName?.[0] || "U"}
                        </div>
                        <div style={styles.userDetails}>
                            <span style={styles.userNameNav}>{user?.first_name || user?.firstName} {user?.last_name || user?.lastName}</span>
                            <span style={styles.userRole}>Dept: {user?.department_code || user?.departmentCode}</span>
                        </div>
                    </div>
                    <button onClick={onLogout} style={styles.logoutBtnNav} title="Logout">
                        <LogOut size={18} />
                    </button>
                </div>
            </nav>

            <div style={styles.mainContainer}>
                <Sidebar
                    sidebarOpen={sidebarOpen}
                    activeService={activeService}
                    setActiveService={setActiveService}
                    userRole={user?.role || "user"}
                />

                <main style={styles.content}>
                    {renderContent()}
                </main>
            </div>
        </div>
    );
}
